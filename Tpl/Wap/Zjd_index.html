<!DOCTYPE html>
<html>
	<head>
		<title>{$cjdata['title']}</title>
		<meta charset="utf-8" />
		<!--页面优化-->
		<meta name="MobileOptimized" content="320">
		<!--默认宽度320-->
		<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
		<!--viewport 等比 不缩放-->
		<meta http-equiv="cleartype" content="on">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<!--删除苹果菜单-->
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<!--默认颜色-->
		<meta name="apple-mobile-web-app-title" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<!--加载全部后 显示-->
		<meta content="telephone=no" name="format-detection" />
		<!--不识别电话-->
		<meta content="email=no" name="format-detection" />
		<link rel="stylesheet" href="__PUBLIC__/Wap/zjd/css/zajd.css" />
		<script type="text/javascript" src="__PUBLIC__/Wap/js/zepto.min.js"></script>
	</head>
	<body style="background-color: #110804;">
		<!-- 砸金蛋背景1 宽：720px -->
		<empty name="cjdata['cjimg1']['imgurl']">
		<div><img src="__PUBLIC__/Wap/zjd/img/egg_bg1.jpg"></div>
		<else />
		<div><img src="{$cjdata['cjimg1']['imgurl']}"></div>
		</empty>
		<div class="egg_box" id="egg_box">
		<!-- 砸金蛋背景2 宽：720px -->
		<empty name="cjdata['cjimg2']['imgurl']">
			<div class="egg_bg"><img src="__PUBLIC__/Wap/zjd/img/egg_bg.jpg"></div>
		<else />
			<div class="egg_bg"><img src="{$cjdata['cjimg2']['imgurl']}"></div>
		</empty>
			<div class="egg_03"><a id="egg3" data-prize="<eq name='cjdata.isprize' value='1'>1<else/>0</eq>">&nbsp;</a></div>
			<div class="egg_01"><a id="egg1" data-prize="<eq name='cjdata.isprize' value='1'>1<else/>0</eq>">&nbsp;</a></div>
			<div class="egg_02"><a id="egg2" data-prize="<eq name='cjdata.isprize' value='1'>1<else/>0</eq>">&nbsp;</a></div>
			<div class="hit" id="hit"><img src="__PUBLIC__/Wap/zjd/img/chuiz.png"></div>
		</div>
		<div class="look_re one"><a href="#">我的中奖纪录</a></div>
		<eq name="dzp['isfx']" value="1">
			<div class="look_re"><a id="share">分享活动</a></div>
			<p style="text-align: center;font-size: 0.625em;color:white;">分享活动即可获得额外抽奖机会哦！</p>
		</eq>
		<div class="egg_tit"><img src="__PUBLIC__/Wap/zjd/img/tit03.png"></div>
		<ul class="on_re">
			<empty name='zj'><li style='text-align:center; margin:30px 0;'>暂无数据</li></empty>
			<!-- <volist name='zj' id='vo'>	
				<li><span>{$vo.nickname}</span><em>{$vo.ctime}</em><i>{$vo.prizename}</i></li>
			</volist> -->
		</ul>
		<div class="egg_tit"><img src="__PUBLIC__/Wap/zjd/img/tit01.png"></div>
		<ul class="egg_txt">
			<volist name="prize" id='vo'>
				<li><em>{$vo['lname']}：</em><p>{$vo['pname']}</p></li>
			</volist>
		</ul>
		<div class="egg_tit"><img src="__PUBLIC__/Wap/zjd/img/tit02.png"></div>
		<ul class="egg_txt_x">
			<!-- <volist name="cjdata['hdsummary']" id='vo' key='k'>
				<li><em>{$k}.</em><p>{$vo}</p></li>
			</volist> -->
			<li><em>{$k}.</em><p>{$dzp['content']}</p></li>
			<!-- <li></li> -->
		</ul>
		
		<!--中奖弹出框-->
		<div class="egg_out_box" style="display: none;" id="mark-zj">
			<div class="win">
				<img src="__PUBLIC__/Wap/zjd/img/on.png">
				<a class="winon" href="#"><img src="__PUBLIC__/Wap/zjd/img/on-1.png"></a>
			</div>
		</div>
		
		<!--未中奖弹出框-->
		<div class="egg_out_box"  style="display: none;" id="mark-wzj">
			<div class="lose">
				<img src="__PUBLIC__/Wap/zjd/img/off.png">
				<div class="lose_txt">
					<p>亲！很遗憾没有中奖</p>
					<p>继续努力哦！还有<em>{$cjdata['num']}</em>次机会！</p>
				</div>
				<a id="off" href="#"><img src="__PUBLIC__/Wap/zjd/img/off-1.png"></a>
			</div>
		</div>
		
		<!--中奖后填写信息框-->
		<div class="egg_out_box"  style="display: none;" id="mark-info">
			<div class="win_info">
				<div class="sj_inf">
					<eq name="cjdata['isform']" value="1">
					<p id="re" style="font-size:1.5em;text-align:center">中奖啦！请填写信息！</p>
					<else />
					<p id="re" style="font-size:1.5em;text-align:center">中奖啦！等待发奖吧！</p>
					</eq>
				</div>
				<eq name="cjdata['isform']" value="1">

				<div class="yh_info">
					<form id="form-data">
						<input type="hidden" id="id" name="vid" value="{$ac.0.v.id}">
							
						<if condition="$redata['dzpid'] eq ''">
							<input type="hidden" id="lid" name="id" value="{$cjdata.id}">
						<else />
							<input type="hidden" id="lid" name="id" value="{$redata.dzpid}">
						</if>
						<volist name="ac" id="vo">
								<p><em>{$vo.name}：</em><input class="formdata" type="{$vo.type}" value="{$vo.v.name}" name="{$vo.fields}"></p>
							
						</volist>
						<a id="submit" href="#">提交</a>
					</form>					
				</div>


				</eq>


			</div>
		</div>
		
		<div class="egg_out_box"  style="display: none;" id="infoout">
			<div class="win_info">
				<div class="sj_inf">
					<!-- 1-13 zyf 此处要遍历用户中的奖品 -->
					<foreach name="zj_res" item="vo">
						<p id="sn">恭喜你中了:{$vo.prizename}</p>
						<p id="sn">兑换SN码：{$vo.sn}</p>
					</foreach>
					<!-- 1-13 zyf 此处要遍历用户中的奖品 -->
					<p>联系电话：<a href="tel:{$cjdata['tel']}">{$cjdata['tel']}</a></p>
					<p>线下兑换：{$cjdata['address']}</p>
					<a class="winon" href="#"><img src="__PUBLIC__/Wap/zjd/img/on-1.png"></a>
				</div>
			</div>
		</div>
		
		<!-- 1-15 zyf 广告 -->
		<eq name="dzp['ifaddr']" value="1">
		<style>
			.act_addr{width:100%;position:fixed;bottom:0px;background-color:black;overflow: hidden;}
			.act_addr .close{padding:0 5px;position:absolute;right:0;top:0;border:1px solid black;background-color:white;}
		</style>

		<div class="act_addr">
			<a href="{$dzp['addrurl']}" style="display: block;height:50px;margin:0 auto;"><img src="{$dzp['addrpic']['imgurl']}"></a>
			<div class="close"><span>X</span></div>
			<script>
				$(".act_addr .close").click(function(){
					$(this).parent().remove();
				})
			</script>
		</div>
		</eq>
		<!-- 1-15 zyf 广告 -->
<!--分享弹窗-->	
	<div class="fx" style="display: none;" >
		<img src="__PUBLIC__/Wap/img/share.png";/>
	</div>
<!--分享弹窗-->


		<script type="text/javascript">
		var start=1;//"{$cjdata['is_star']}",
		var openprize="{$user.openprize}";
		var token="{$dzpToken}";
		
		$('.one').click(function(){
			if(openprize ==1){
				$('#infoout').show();
			}else{
				alert('您还没有中奖!');
			}		
		})
		$('#infoout').click(function(){
			$('#infoout').hide();
		})
			
			function eggClick(obj) {
				if(start==0){
					$('#mark-wzj').show();
					$('#mark-wzj').find('.lose_txt').html('活动未开始！');
					return false;
				}
				if(start==2){
					$('#mark-wzj').show();
					$('#mark-wzj').find('.lose_txt').html('活动已结束！');
					return false;
				}

				/* 1-15 zyf 这里要判断是否允许重复中奖 */
				<eq name="dzp['zjrepeat']" value="0">
				if (openprize==1) {
					if("{$user.is_info}"==1){
						$('#mark-wzj .lose_txt').html('您已中过了,下次再玩！');
						$('#mark-wzj').show();
						return false;
					}else{
						// 是否需要填写信息
						if("{$cjdata['isform']}"==1){
							$('#mark-info #re').html('中奖啦！请填写信息！');	
						}else{
							$('#mark-info #re').html('中奖啦！等待发奖把！');	
						}	
						$('#mark-info').show();		
						return false;
					}
				}
				</eq>
				/* 1-15 zyf 这里要判断是否允许重复中奖 */
				if("{$cjdata['isform']}"==1){
				/* 1-14 zyf 这里判断抽奖前还是抽奖后填写信息 */
				// isgz 0是抽奖前填写
					if("{$cjdata['isgz']}"==0){
						// 还没填写过
						if("{$cjdata['hastx']}"==0){
							$("#mark-info #re").html("先填写详细信息把~");
							$("#mark-info").show();
							return false;
						}
					}
				// isgz 1是抽奖后填写
				/* 1-14 zyf 这里判断抽奖前还是抽奖后填写信息 */
				}



				// alert("{$cjdata['ist']}");
				// alert("{$cjdata['num']}");
				var paytype=0;
				if("{$cjdata['num']}" ==0){
					if("{$pay['type']}"!=false){
						// 开启了继续支付抽奖
						if(confirm("您的免费次数已经用完，是否消费{$pay['num']}{$pay['name']}，来增加一次抽奖机会？")){
							paytype="{$pay['type']}";
						}else{
							return false;
						}
					}else{
						if("{$cjdata['ist']}" ==1){
							$('#mark-wzj .lose_txt').html('您已超过'+"{$cjdata['lnum']}"+'次,明天再玩！');
						}else{
							$('#mark-wzj .lose_txt').html('您已超过'+"{$cjdata['lnum']}"+'次,下次再玩！');
						}
						$('#mark-wzj').show();
						return false;
					}
				}

				var _this = obj;

				$.ajax({
					type : "post",
					url : "{:U('Wap/Zjd/saveCjResult')}",
					data : {
						//uid : "{$cjdata.uid}",
						id : "{$cjdata.id}",
						paytype : paytype,
						token:token,
					},
					dataType : 'json',
					success : function(res) {
						token=res.token;
						$("#hit").css({left: _this.pageX+"px",top: _this.pageY+"px"});
	                    if(res.status){
	                       	$('#mark-wzj .lose_txt').html(res.info);
							$('#mark-wzj').show();
	                       	return false;
	                    }
						//$("#hit").animate({top:_this.pageY+"px",left: _this.pageX+"px"},30,function(){
						//		_this.addClass("hover"); //蛋碎效果
							if(res.id){
								$('#mark-zj').show();
							}else{
								if(res.num==-1){
									$('#mark-wzj em').html("无限");
									$('#mark-wzj').show();
								}else{
									$('#mark-wzj em').html(res.num);
									$('#mark-wzj').show();
								}
							}	
						//	})
						}
					});
				}
			
			
			$(".egg_box div a").click(function() {
				eggClick($(this));
				var posL = $(this).position().left + $(this).width()*0.5;
				$("#hit").show().css('left', posL);
			});
			
			//中奖关闭
			$('.winon').on('click',function(e){
				$.ajax({
						type : "post",
						url : "{:U('Wap/Zjd/win')}",
						data : {
							//uid : "{$cjdata.uid}",
							id : "{$cjdata.id}"
							},
						dataType : 'json',
						success : function(res) {
							$('#id').val(res.id);
							$('#sn').html('兑换SN码：'+res.sn);
						}
					});
				$('#mark-info').show();		
			});
			
			//未中奖关闭
			$('#off').on('click',function(e){	
				window.location.reload();
			});
			//提交用户信息
			$('#submit').click(function(){
				var k='0';
				var form_input = $('.formdata');
				form_input.each(function(a){
					if(!form_input.eq(a).val()){
						var v = form_input.eq(a).prev().text();
						v = v.substring(0,-1);
						k='1';
					}
				})
				
				if(k == '1'){
					alert('请填写信息');
					return false;
				}
				
				var data =$('#form-data').serialize();
				$.ajax({
					type:"post",
					url:"{:U('Wap/Zjd/zjuser')}",
					data:data,
					async:true,
					success : function(o) {
						if(o.status==1){
							alert(o.msg);
							window.location.reload();
						}
					}
				});
			});
			
			var count = "{$cjdata['count']}",num =1;
			var t=setInterval(function(){
				$.ajax({
					type : "post",
					url : "{:U('Wap/Zjd/getdata')}",
					data : {
						//uid : "{$cjdata.uid}",
						id : "{$cjdata.id}",
						num:num
						},
					dataType : 'json',
					success : function(res) {
						if(res.status==1){
							$(".on_re li").remove();
							$.each(res.msg,function(index,item){  
		                  		$(".on_re").append("<li><span>"+item.nickname+"</span><em>"+item.ctime+"</em><i>"+item.prize+"</i></li>");  
		              		}); 
						}else{
						}								
					}
				});
				if(num <count){
					num++;
				}else{
					//clearTimeout(t);
					num =1;
				}		
			},2000);

		</script>
		<script>	
			//shareInfo();
			$('#share').click(function(){
			 	$('.fx').css({'width':'100%','display':'block','position': 'fixed','z-index':10000,'top':'0px','left':'0px','background':'#000','opacity':0.7,'width':$(window).width(),'height':$(window).height()});
			});
			$('.fx').click(function(){
			 	$(this).hide();
			})
			 
			function shareInfo(){
			 	
			 	//var uid="{$uid}";
			 	var dzpid="{$dzpid}";
			 	var vipid="{$vipid}";				
				$.ajax({
			 		type:"get",
			 		url:"{:U('wap/Zjd/shareInfo')}",
			 		//data:{'uid':uid,'dzpid':dzpid,'vipid':vipid},
			 		data:{'dzpid':dzpid,'vipid':vipid},
			 		async:true,
			 		success:function(data){
						//alert(data);
						//alert(data.msg);
//						if(data.status=='1'){
//							alert(data.msg);
//						}else{
//							alert(data.msg);
//						}
			 		}
			 	});
			 	
			}
		</script>
				<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script>
		var share_url = "{$_SESSION['SET']['wxurl']}/wap/Zjd/index/id/{$dzpid}";
		var share_title="{$dzp.sharetitle}";
		var share_content="{$dzp.sharecontent}";
		var share_img="{$_SESSION['SET']['wxurl']}{$picurl}";
	var fxstatic=0;
	
  wx.config({
      debug: false,
      appId: "{$jsapi['appId']}",
	  timestamp: "{$jsapi['timestamp']}",
	  nonceStr: "{$jsapi['nonceStr']}",
	  signature: "{$jsapi['signature']}",
      jsApiList: [
        'checkJsApi',
        'onMenuShareTimeline',
        'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo',
        'hideMenuItems',
        'showMenuItems',
        'hideAllNonBaseMenuItem',
        'showAllNonBaseMenuItem',
     // 'translateVoice',
     // 'startRecord',
     // 'stopRecord',
     // 'onRecordEnd',
     // 'playVoice',
     // 'pauseVoice',
     // 'stopVoice',
     // 'uploadVoice',
     // 'downloadVoice',
     // 'chooseImage',
     // 'previewImage',
     // 'uploadImage',
     // 'downloadImage',
     // 'getNetworkType',
     // 'openLocation',
     // 'getLocation',
     // 'hideOptionMenu',
     // 'showOptionMenu',
     // 'closeWindow',
     // 'scanQRCode',
     // 'chooseWXPay',
     // 'openProductSpecificView',
     // 'addCard',
     // 'chooseCard',
     // 'openCard'
      ]
  });
  
  wx.ready(function () {
	  	//开启菜单
	  	wx.showOptionMenu();
	  	//隐藏菜单
	  	//wx.hideOptionMenu();
	    //分享给朋友
	    wx.onMenuShareAppMessage({
	      title: share_title,
	      desc: share_content,
	      link: share_url,
	      imgUrl: share_img,
	      trigger: function (res) {
	        //alert('用户点击发送给朋友');
	      },
	      success: function (res) {
	       fxstatic==1;
	       shareInfo();
	      },
	      cancel: function (res) {
	        //alert('已取消');
	      },
	      fail: function (res) {
	        //alert(JSON.stringify(res));
	      }
	    });
	    //分享到朋友圈
	    wx.onMenuShareTimeline({
	      title: share_title,
	      link: share_url,
	      imgUrl: share_img,
	      trigger: function (res) {
	        //alert('用户点击分享到朋友圈');
	      },
	      success: function (res) {
	        fxstatic==1;
	        shareInfo();
	      },
	      cancel: function (res) {
	        //alert('已取消');
	      },
	      fail: function (res) {
	        //alert(JSON.stringify(res));
	      }
	    });
	    //分享到QQ
	    wx.onMenuShareQQ({
	      title: share_title,
	      desc: share_content,
	      link: share_url,
	      imgUrl: share_img,
	      trigger: function (res) {
	        //alert('用户点击分享到QQ');
	      },
	      complete: function (res) {
	        //alert(JSON.stringify(res));
	      },
	      success: function (res) {
	        fxstatic==1;
	        shareInfo();
	      },
	      cancel: function (res) {
	        //alert('已取消');
	      },
	      fail: function (res) {
	        //alert(JSON.stringify(res));
	      }
	    });
  });
</script>
	</body>
</html>
